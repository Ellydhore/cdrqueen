{% extends 'profile_container.html' %}
{% load static %}

{% block css_block %}
    <link rel="stylesheet" href="{% static 'css/profile_container.css' %}">
    <link rel="stylesheet" href="{% static 'css/address.css' %}">
{% endblock %}

{% block title %}Address{% endblock %}

{% block page_name %}My Account{% endblock %}
{% block subpage_name %}Address{% endblock %}

{% block add_button %}
<div>
    <button class="add-address-btn" id="add-address-btn">+ Add Address</button>
</div>
{% endblock %}

{% block profile_contents %}

{% for address in addresses %}
<div class="address-container flex mb-5">
    <!-- First Column -->
    <div class="flex-none w-4/5 p-3">
        <div class="">
            <div class="p-2">
                <p class="name-detail inline">{{ request.user.first_name }} {{ request.user.last_name }} | </p>
                <p class="address-details inline">{{ address.phone_number }}</p>
                <p class="address-details">{{ address.street }}, {{ address.barangay }}</p>
                <p class="address-details">{{ address.city }}, {{ address.province }}, {{ address.region }}, {{ address.country }} - {{ address.postal_code }}</p>
            </div>
            <div class="p-2 select-none">
                <div class="address-type">{{ address.get_address_label_display }}</div>
                <div class="address-type">{{ address.get_address_type_display }}</div>
            </div>
        </div>
    </div>
    <!-- Second Column -->
    <div class="flex-none w-1/5 p-4">
        <div>
            <div class="flex flex-row items-center justify-between p-2">
                <button class="edit-btn" data-id="{{ address.id }}">Edit</button>
                <button class="delete-btn">Delete</button>
            </div>
            <div class="flex items-center justify-center p-2">
                <button class="set-btn">Set as default</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}
<div class="overlay hidden" id="modal-overlay"></div>
<!-- Modal Structure -->
<div class="modal hidden" enctype="multipart/form-data" id="add-address-modal">
    <p class="message mb-4">Add Address</p>

    <!-- Address Form -->
    <form id="add-address-form" method="POST" action="{% url 'add_address' %}">
        {% csrf_token %}
        <div class="form-row">
            <div class="form-group">
                <input type="text" id="phone-number" name="phone_number" placeholder="+63XXXXXXXXXX" required>
            </div>
            <div class="form-group">
                <select id="address-label" name="address_label" required>
                    <option value="home">Home</option>
                    <option value="work">Work</option>
                </select>
            </div>

            <div class="form-group">
                <select id="address-type" name="address_type" required>
                    <option value="default">Default</option>
                    <option value="pickup_address">Pickup Address</option>
                    <option value="return_address">Return Address</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <input type="text" id="street" name="street" placeholder="Street Name" required>
        </div>

        <!-- Grouped Fields -->
        <div class="form-row">
            <div class="form-group">
                <input type="text" id="barangay" name="barangay" placeholder="Barangay" required>
            </div>
            <div class="form-group">
                <input type="text" id="city" name="city" placeholder="City" required>
            </div>
            <div class="form-group">
                <input type="text" id="province" name="province" placeholder="Province" required>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <input type="text" id="region" name="region" placeholder="Region" required>
            </div>
            <div class="form-group">
                <input type="text" id="country" name="country" placeholder="Country" required>
            </div>
            <div class="form-group">
                <input type="text" id="postal-code" name="postal_code" placeholder="Postal Code" required>
            </div>
        </div>

        <div class="form-group">
            <textarea id="specific-location" name="specific_location" placeholder="Describe specific location"></textarea>
        </div>

        <div class="options">
            <button type="button" class="btn" id="cancel-btn">Cancel</button>
            <button type="submit" class="btn" id="save-btn">Save Address</button>
        </div>
    </form>
</div>
{% endblock %}

{% block js_block %}
<script>
    const addButton = document.getElementById('add-address-btn');
    const modal = document.getElementById('add-address-modal');
    const overlay = document.getElementById('modal-overlay');
    const saveButton = document.getElementById('save-btn');
    const cancelButton = document.getElementById('cancel-btn');
    const form = document.getElementById('add-address-form');

    // Function to show the modal and overlay
    addButton.addEventListener('click', () => {
        overlay.classList.add('show'); // Show the overlay
        modal.classList.remove('hidden'); // Show the modal
    });

    // Function to handle the 'Save' button and submit the form
    saveButton.addEventListener('click', () => {
        form.submit(); // Submit the form
        modal.classList.add('hidden'); // Hide the modal
        overlay.classList.remove('show'); // Hide the overlay
    });

    // Function to handle the 'Cancel' button
    cancelButton.addEventListener('click', () => {
        modal.classList.add('hidden'); // Hide the modal
        overlay.classList.remove('show'); // Hide the overlay
    });

    // Optional: Close the modal and overlay when clicking on the overlay
    overlay.addEventListener('click', () => {
        modal.classList.add('hidden');
        overlay.classList.remove('show');
    });

</script>
{% endblock %}
